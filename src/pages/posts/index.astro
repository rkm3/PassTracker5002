---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// Fetch all entries from the posts collection
const allEntries = await getCollection('posts');

// Filter entries to ensure they match the expected schema (contain pubDate)
const posts = allEntries
  .filter(entry => 'pubDate' in entry.data) // Ensure it looks like a Post entry
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const pageTitle = "All Posts";
const baseUrl = import.meta.env.BASE_URL;
---
<Layout title={pageTitle}>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-4xl font-bold mb-8">{pageTitle}</h1>
    <ul class="space-y-4">
      {posts.map((post) => (
        <li class="border-b pb-2">
          <h2 class="text-2xl font-semibold">
            <a href={`${baseUrl}/posts/${post.slug}`} target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline">
              {post.data.title}
            </a>
          </h2>
          <p class="text-gray-600 text-sm">
            Published on: {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
          </p>
          <p>
            <a href={post.data.url} class="text-blue-600 hover:underline">Read Post</a>
          </p>
        </li>
      ))}
    </ul>
  </div>
</Layout>